<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roblox Player Game Checker</title>
<style>
    body {font-family: Arial, sans-serif; background: #f2f2f2; display:flex; justify-content:center; align-items:flex-start; padding-top:50px;}
    #checker {position: fixed; left: 20px; top: 80px; width: 320px; background: #fff; border-radius: 10px; box-shadow: 0 8px 24px rgba(0,0,0,0.12); padding: 12px; user-select: none;}
    #checker-header {cursor: move; font-weight: 700; margin-bottom: 8px; display:flex; justify-content:space-between; font-size: 14px;}
    #checker input {flex:1; padding:8px; border-radius: 8px; border:1px solid #ccc; outline:none; font-size: 13px;}
    #checker button {padding:8px 10px; border:none; border-radius:8px; background:#1376F2; color:#fff; font-weight:600; cursor:pointer;}
    #result {margin-top:10px; padding:8px; border-radius:8px; background:#f9f9f9; min-height:34px; display:flex; align-items:center; font-size:13px;}
</style>
</head>
<body>
<div id="checker">
    <div id="checker-header">
        <div>Player Game Checker</div>
        <div style="font-size:12px;color:#666;">v1</div>
    </div>
    <div style="display:flex;gap:8px;">
        <input id="usernameInput" placeholder="Username or ID">
        <button id="checkBtn">Check</button>
    </div>
    <div id="result">Enter a username or ID and click Check</div>
</div>

<script>
const proxy = {
    users: 'https://users.roproxy.com/v1/usernames/users',
    presence: 'https://presence.roproxy.com/v1/presence/users',
    games: 'https://games.roproxy.com/v1/games/multiget-place-details'
};

const checker = document.getElementById('checker');
const header = document.getElementById('checker-header');
const input = document.getElementById('usernameInput');
const button = document.getElementById('checkBtn');
const result = document.getElementById('result');

let dragging = false;
let offset = {x:0, y:0};

header.addEventListener('mousedown', e => {
    dragging = true;
    const rect = checker.getBoundingClientRect();
    offset.x = e.clientX - rect.left;
    offset.y = e.clientY - rect.top;
});

window.addEventListener('mousemove', e => {
    if(!dragging) return;
    checker.style.left = (e.clientX - offset.x) + 'px';
    checker.style.top = (e.clientY - offset.y) + 'px';
});

window.addEventListener('mouseup', () => dragging = false);

function isNumeric(str){ return /^\d+$/.test(str.trim()); }

async function fetchJson(url, opts = {}) {
    const res = await fetch(url, opts);
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    return res.json();
}

async function resolveUser(inputVal){
    inputVal = inputVal.trim();
    if(!inputVal) throw new Error('No input provided');
    if(isNumeric(inputVal)) return Number(inputVal);
    const payload = {usernames:[inputVal]};
    const data = await fetchJson(proxy.users, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
    if(!data || !data.data || data.data.length === 0) throw new Error('Username not found');
    return data.data[0].id;
}

async function getPresence(userId){
    const url = `${proxy.presence}?userIds=${encodeURIComponent(userId)}`;
    const data = await fetchJson(url);
    if(!data || !Array.isArray(data.userPresences)) throw new Error('No presence data');
    return data.userPresences.find(p=>String(p.userId)===String(userId)) || null;
}

async function getPlaceName(placeId){
    if(!placeId) return null;
    const url = `${proxy.games}?placeIds=${encodeURIComponent(placeId)}`;
    const data = await fetchJson(url);
    if(!Array.isArray(data) || data.length === 0) return null;
    return data[0]?.name || null;
}

async function checkPlayer(){
    try{
        button.disabled = true;
        button.style.opacity = '0.6';
        result.textContent = 'Resolving user...';
        const raw = input.value;
        const userId = await resolveUser(raw);
        result.textContent = `Found user id ${userId}. Checking presence...`;
        const pres = await getPresence(userId);
        if(!pres) { result.textContent = 'No presence info'; return; }
        const placeId = pres.placeId || pres.rootPlaceId || null;
        if(!placeId) { result.textContent = 'User not in a public game'; return; }
        result.textContent = 'Fetching game details...';
        const name = await getPlaceName(placeId);
        result.textContent = name ? `Player is in: ${name}` : `Player is in a game (placeId: ${placeId})`;
    }catch(e){
        result.textContent = 'Error: ' + e.message;
    }finally{
        button.disabled = false;
        button.style.opacity = '1';
    }
}

button.addEventListener('click', checkPlayer);
input.addEventListener('keydown', e => { if(e.key === 'Enter') checkPlayer(); });
</script>
</body>
</html>
