<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roblox 3D Avatar Viewer</title>
<style>
  body {margin:0;padding:0;font-family:Arial,sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;background:linear-gradient(135deg,#242424,#555);color:#fff;}
  .container {background: rgba(0,0,0,0.7);padding:30px;border-radius:15px;text-align:center;}
  input, button {padding:10px;font-size:16px;margin:8px;border:none;border-radius:8px;}
  input {width:250px;}
  button {background:#e63946;color:#fff;cursor:pointer;}
  button:hover {background:#c52737;}
  img {margin-top:20px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.5);}
  .log {margin-top:20px;font-size:14px;color:#aaa;text-align:left;}
</style>
</head>
<body>
<div class="container">
  <h1>Roblox Avatar Viewer</h1>
  <input type="text" id="usernameOrId" placeholder="Enter Roblox username or ID">
  <button id="viewBtn">View Avatar</button>
  <div>
    <img id="avatar" src="" alt="" width="420" height="420" style="display:none">
  </div>
  <div class="log" id="log"></div>
</div>

<script>
function log(msg) { document.getElementById('log').textContent += msg+'\n'; }

async function getUserId(input) {
  if (!isNaN(input)) { log('Input is numeric, using as ID: '+input); return input; }
  log('Looking up username: '+input);
  const res = await fetch('https://users.roblox.com/v1/usernames/users', {
    method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({usernames:[input],excludeBannedUsers:false})
  });
  if (!res.ok) throw new Error('Username lookup failed: '+res.status);
  const data = await res.json();
  log('Username lookup result: '+JSON.stringify(data));
  if (!data.data || data.data.length===0) throw new Error('User not found for username');
  return data.data[0].id;
}

async function showAvatar() {
  try {
    document.getElementById('avatar').style.display='none';
    document.getElementById('log').textContent='';
    const input = document.getElementById('usernameOrId').value.trim();
    if (!input) { log('No input'); return; }
    const userId = await getUserId(input);
    log('Using userId: '+userId);

    const url = `https://thumbnails.roblox.com/v1/users/avatar?userIds=${userId}&size=420x420&format=Png&isCircular=false`;
    log('Fetching thumbnail JSON from: '+url);
    const thumbRes = await fetch(url);
    if (!thumbRes.ok) throw new Error('Thumbnail request failed: '+thumbRes.status);
    const thumbData = await thumbRes.json();
    log('Thumbnail API response: '+JSON.stringify(thumbData));

    if (!thumbData.data || thumbData.data.length===0) throw new Error('No thumbnail data found');

    // ðŸ”¥ Hereâ€™s the fix: just use the imageUrl directly in <img>
    const imageUrl = thumbData.data[0].imageUrl;
    log('Got imageUrl: '+imageUrl);
    const imgEl = document.getElementById('avatar');
    imgEl.src = imageUrl;
    imgEl.style.display='block';

  } catch(err) {
    alert('Error: '+err.message);
    log('ERROR: '+err.message);
  }
}

document.getElementById('viewBtn').addEventListener('click',showAvatar);
</script>
</body>
</html>
